250624

## ë§ˆë¦¬ì•„DB ì„¤ì¹˜
--> docker ì´ìš©í•´ì„œ..
ì¤€ë¹„ë¬¼) ë„ì»¤ì‹¤í–‰, í„°ë¯¸ë„ì—ì„œ ì„¤ì¹˜
1.
docker pull mariadb
2.
docker run -p 3306:3306 --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] -e MARIADB_ROOT_PASSWORD=[ë¹„ë°€ë²ˆí˜¸] -d mariadb
ex) docker run -p 3306:3306 --name mariaDB -e MARIADB_ROOT_PASSWORD=1234 -d mariadb
3. MariaDBì— ì ‘ì†í•˜ê¸°
docker exec -it [ì»¨í…Œì´ë„ˆ ì´ë¦„] mariadb -uroot -p
ex) docker exec -it mariaDB mariadb -uroot -p

## MariaDB ì‚¬ìš©ì ì¶”ê°€ ë° user ê¶Œí•œ ì„¤ì •

1. ë°ì´í„° ë² ì´ìŠ¤ ìƒì„±
create database {db_name};
ex) create database webdb;
2. ì‚¬ìš©ì ì¶”ê°€
create user 'user_name'@'ip_address' identified by 'user_password';
ex) create user 'webuser'@'%' identified by 'webuser';
3. ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ë¶€ì—¬
grant all privileges on db_name.* to 'user_name'@'ip_address';
ex) grant all privileges on *.* to 'webuser'@'%';
4. ë³€ê²½ì‚¬í•­ ì ìš©
flush privileges;

## ë§ˆë¦¬ì•„DB ì‹œê°„ë™ê¸°í™”
-->ë„ì»¤ ë°ìŠ¤í¬í†±ì˜ ë§ˆë¦¬ì•„DB ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í›„ ,
1)
docker exec -it [ì»¨í…Œì´ë„ˆ ì•„ì´ë””] /bin/bash
ex) docker exec -it 423e71a0d0b7bed571b946548a228b51b0b16c5a1a5b6eab6a75d2307511b408 /bin/bash
3da9c241a286

2)
dpkg-reconfigure tzdata
2-1)
ì•ˆë  ê²½ìš°
apt-get update
apt-get install --reinstall tzdata
3)
5 asia
4)
68 seoul
5)
date í™•ì¸.
6) docker ì„œë²„ ë„ê³  ë‹¤ì‹œ ì‹¤í–‰

## ê¸°ë³¸ ì„¤ì • ë°©ë²•
ë§ˆë¦¬ì•„ ë””ë¹„ ì„¤ì¹˜ í›„,
ì›¹ (jsp) í”„ë¡œì íŠ¸ ì—°ê²°í•˜ê¸°.
1. build.gradle íŒŒì¼ì— í•´ë‹¹ JSTLë¬¸ ì‘ì„±
implementation group: 'org.mariadb.jdbc', name: 'mariadb-java-client', version: '3.5.1'

<-VS-> NoSQL... ëª½ê³ ë””ë¹„(Key, Value êµ¬ì¡°), êµ¬ê¸€(ì„œë²„ë¦¬ìŠ¤, íŒŒì´ì–´ë² ì´ìŠ¤) : ë¹…ë°ì´í„°ê´€ë ¨ ì €ì¥í•˜ê¸°ìœ„í•´ ì„¤ê³„

ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡
ë§ˆë¦¬ì•„ DB
ë¬¸ìì—´, ìˆ«ì, ë°ì´í„° íƒ€ì…ì—ëŒ€í•´ì„œ ë©”ëª¨.

ì •ìˆ˜, íƒ€ì….
1) TINYINT : ë§¤ìš° ì‘ì€ ì •ìˆ˜, 1byte , -128 ~ 127
2) INT : 4byte , ë²”ìœ„ ëŠ” ìƒëµ, - 2^31 ~
3) BIGINT : 8byte, ë²”ìœ„ëŠ” ìƒëµ, ì•½ -2^63 ~
ì†Œìˆ˜
4) FLOAT : 4byte ,
5) DOUBLE : 8byte

ë‚ ì§œ, íƒ€ì…
1) DATE , 3byte, yyyy-mm-dd
2) DATETIME, 8byte yyyy-mm-dd - hh:mm:ss
3) TIME , 3byte, hh:mm:ss

ë¬¸ìì—´ íƒ€ì….
1)VARCHAR(n) : Length + 1 byte ,
2)TEXT : ìµœëŒ€ í¬ê¸° 64ë°”ì´íŠ¸
3)LONGTEXT : ìµœëŒ€í¬ê¸° 4GB
4)BLOB(Binary Large Oboject) : ìµœëŒ€ í¬ê¸° 64kb, ìŒì„±, ì´ë¯¸ì§€, ì˜ìƒ, ê¾¸ì—­ê¾¸ì—­ ë„£ì–´ì„œ,
í˜ë“¤ê²Œ ë¶ˆëŸ¬ì˜´. -> ë¯¸ë””ì–´ ì„œë²„ì—ê²Œ ìœ„ì„í• ê²ƒ.
5)LONGBLOB : ìµœëŒ€ í¬ê¸° 4GB

ê²°ë¡ ) ë””ë¹„ ì„¤ê³„ì‹œ,í¬ê²Œ, ê·œëª¨ë¥¼ ì¡ì•„ë‘ê¸°... ex) íšŒì› ì˜ ìˆ«ì :1000, int ,
ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡
## Lombok
ë¼ì´ë¸ŒëŸ¬ë¦¬. : Get/Set/ToString/Equals/ìƒì„±ì/Builder íŒ¨í„´ ë“± ë°˜ìë™.
ë„êµ¬ë¥¼ ë¯¸ë¦¬ ì„¤ì¹˜í›„, ë©”ëª¨ë¦¬ ìƒì—ì„œ ë„ì›Œì„œ ì‚¬ìš©í•¨.
ì‚¬ìš©ë²•ì€ @getter , ì–´ë…¸í…Œì´ì…˜ë§Œ ë¶™ì´ë©´, ë°”ë¡œ ì‚¬ìš©ê°€ëŠ¥í•¨.

//ì›ë˜ ìš°ë¦¬ê°€ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë°©ë²•
    //TodoVO Todo = new TodoVO();
    TodoVO todoVO = new TodoVO();
    todoVO.setTno(200L);
    todoVO.setTitle("ì œëª©200");
    todoVO.setDueDate(LocalDate.now());

    System.out.println(todoVO);

    TodoVO todo = TodoVO.builder()
        .tno(100L)
        .title("ì œëª©100")
        .dueDate(LocalDate.now())
        .build();
System.out.println(todo);


## HikariCPë€?

HikariCPëŠ” ê°€ë³ê³  ë¹ ë¥´ë©° ì•ˆì •ì ì¸ JDBC ì»¤ë„¥ì…˜ í’€(Connection Pool) ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. 
ì´ë¦„ì²˜ëŸ¼ ë§¤ìš° ë¹ ë¥¸ ì„±ëŠ¥ì„ ìë‘í•©ë‹ˆë‹¤. 
 -ì£¼ìš” ì„¤ì • ì˜µì…˜

|  	ì„¤ì •		|  			ì„¤ëª…				| ê¸°ë³¸ê°’ | ê¶Œì¥ê°’ |
|------			|-----------------------------------------------------------------	|--------|
| `minimumIdle` 		| í’€ì—ì„œ ìœ ì§€í•  ìµœì†Œ ìœ íœ´ ì—°ê²° ìˆ˜ 				| 10 | ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë§ê²Œ ì„¤ì • |
| `maximumPoolSize` 	| í’€ì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ ì—°ê²° ìˆ˜ 				| 10 | (ì½”ì–´ ìˆ˜ Ã— 2) + íš¨ê³¼ì ì¸ ë””ìŠ¤í¬ ìˆ˜ |
| `connectionTimeout` 	| í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ì„ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„(ms) 			| 30000 (30ì´ˆ) | ê¸°ë³¸ê°’ ê¶Œì¥ |
| `idleTimeout` 		| ì—°ê²°ì´ í’€ì—ì„œ ìœ íœ´ ìƒíƒœë¡œ ìˆì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ ì‹œê°„(ms) 		| 600000 (10ë¶„) | ê¸°ë³¸ê°’ ê¶Œì¥ |
| `maxLifetime` 		| ì—°ê²°ì˜ ìµœëŒ€ ìˆ˜ëª…(ms) 					| 1800000 (30ë¶„) | DBì˜ ì—°ê²° íƒ€ì„ì•„ì›ƒë³´ë‹¤ ì§§ê²Œ ì„¤ì • |
| `autoCommit` 		| ìë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì • 					| true | ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë§ê²Œ ì„¤ì • |

## DTO (Data Transfer Object)
ğŸ“Œ ëœ»
ë°ì´í„°ë¥¼ í•œ ê³³ì—ì„œ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•œ ê°ì²´
â†’ ì£¼ë¡œ ê³„ì¸µ ê°„ ë°ì´í„° ì „ë‹¬ì— ì‚¬ìš© (ì˜ˆ: ì»¨íŠ¸ë¡¤ëŸ¬ â†” ì„œë¹„ìŠ¤ â†” DAO ê°„)

ğŸ“¦ íŠ¹ì§•
ìˆœìˆ˜ ë°ì´í„° ì €ì¥ìš© í´ë˜ìŠ¤ (getter/setterë§Œ ìˆìŒ)

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì—†ìŒ

í…Œì´ë¸” êµ¬ì¡°ì™€ ìœ ì‚¬í•˜ê²Œ êµ¬ì„±ë¨
public class MemberDTO {
   // ë§¤ê°œë³€ìˆ˜
    private String id;
    private String name;
    private String email;
//---
    // ìƒì„±ì
    public MemberDTO() {}
    public MemberDTO(String id, String name, String email) {
        this.id = id;
        this.name = name;
        this.email = email;
    }
//---
    // getter / setter
    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
}
----------------------------------------------------------------------------------------------------
## DAO (Data Access Object)
ğŸ“Œ ëœ»
ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ CRUD ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê°ì²´

âš™ï¸ íŠ¹ì§•
DB ì—°ê²°, SQL ì‹¤í–‰, ê²°ê³¼ ë§¤í•‘ ì²˜ë¦¬

DTO ê°ì²´ë¥¼ ì…ì¶œë ¥ìœ¼ë¡œ ì‚¬ìš©

ì¼ë°˜ì ìœ¼ë¡œ insert, select, update, delete ë“±ì˜ ë©”ì„œë“œë¥¼ ê°€ì§
		// DAO í´ë˜ìŠ¤: DBì™€ ì§ì ‘ í†µì‹ í•˜ë©° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ì €ì¥í•˜ëŠ” ì—­í• 
public class MemberDAO {

    		// íšŒì› IDë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ë‹¹ íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œ
    public MemberDTO getMemberById(String id) {
        		// ì¡°íšŒ ê²°ê³¼ë¥¼ ë‹´ì„ DTO ë³€ìˆ˜. ì´ˆê¸°ì—ëŠ” nullë¡œ ì„¤ì •.
        MemberDTO member = null;

        try (
            		// DB ì—°ê²°ì„ ìœ„í•œ Connection ê°ì²´ ì–»ê¸°
            Connection conn = ConnectionUtil.INSTANCE.getConnection();

            		// SQL ì¿¼ë¦¬ë¬¸ ì¤€ë¹„: IDë¥¼ ê¸°ì¤€ìœ¼ë¡œ íšŒì›ì •ë³´ ê²€ìƒ‰
            PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM member WHERE id = ?");
        ) {
            		// ì¿¼ë¦¬ë¬¸ì˜ ? ìë¦¬ì— ì „ë‹¬ë°›ì€ id ê°’ì„ ë„£ìŒ
            pstmt.setString(1, id);

            		// ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ResultSet ê°ì²´ë¡œ ë°›ìŒ (ê°€ìƒ í…Œì´ë¸”ì²˜ëŸ¼ ë™ì‘)
            ResultSet rs = pstmt.executeQuery();

            		// ê²°ê³¼ê°€ ìˆìœ¼ë©´ (ì¦‰, í•´ë‹¹ IDë¥¼ ê°€ì§„ íšŒì›ì´ ìˆìœ¼ë©´)
            if (rs.next()) {
                		// ResultSetì—ì„œ ê° ì»¬ëŸ¼ì˜ ê°’ì„ êº¼ë‚´ì„œ MemberDTO ê°ì²´ë¥¼ ìƒì„±
                		// "id", "name", "email"ì€ DB í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…
                member = new MemberDTO(
                    rs.getString("id"),     // id ì»¬ëŸ¼ ê°’
                    rs.getString("name"),   // name ì»¬ëŸ¼ ê°’
                    rs.getString("email")   // email ì»¬ëŸ¼ ê°’
                );
            }

        } catch (Exception e) {
            	// ì˜ˆì™¸ ë°œìƒ ì‹œ, ì½˜ì†”ì— ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
            e.printStackTrace();
        }

        	// ìµœì¢…ì ìœ¼ë¡œ ì¡°íšŒëœ MemberDTO ê°ì²´ë¥¼ ë°˜í™˜ (ì—†ìœ¼ë©´ null ë°˜í™˜)
        return member;
    }
}

****ê²°ë¡ 
- ê´€ê³„ ìš”ì•½
ì—­í• 		í´ë˜ìŠ¤ ì´ë¦„	ì„¤ëª…
ë°ì´í„° ë‹´ê¸°	MemberDTO	ì´ë¦„, ì´ë©”ì¼ ê°™ì€ ë°ì´í„° ì €ì¥
DB ì²˜ë¦¬		MemberDAO	SQLë¬¸ ì‹¤í–‰í•´ì„œ DBì™€ í†µì‹ í•˜ëŠ” ì—­í• 

plaintext
ë³µì‚¬
í¸ì§‘
[DB] â†â†’ DAO â†â†’ DTO â†â†’ Service/Controller
- ğŸ§  ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°
êµ¬ì„±	ë¹„ìœ 				ì‹¤ì œ
DTO	íƒë°° ìƒì (ë¬¼ê±´ ë‹´ëŠ” ìš©ë„)		ë°ì´í„°ë¥¼ ë‹´ëŠ” ê°ì²´
DAO	íƒë°° ê¸°ì‚¬ (ìƒì ì „ë‹¬í•˜ëŠ” ì‚¬ëŒ)	DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ì „ë‹¬í•¨

âœ… ìš”ì•½ ì •ë¦¬
í•­ëª©		|	DTO (=VO)ë°ì´í„°ë¥¼ "ë‹´ëŠ” ìƒì" ì—­í• 	|	DAO
ëª©ì 		|ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•¨			|DBì™€ ì§ì ‘ í†µì‹ í•˜ëŠ” ì—­í• 
í¬í•¨ ë‚´ìš©		|í•„ë“œ, getter/setter				|SQL ì²˜ë¦¬ ë¡œì§
ìœ„ì¹˜		|ê³„ì¸µ ê°„ ë°ì´í„° êµí™˜ (Controller â†” DAO ë“±)	|DB ì‘ì—… ì „ë‹´ ê³„ì¸µ
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§	|âŒ ì—†ìŒ					|â­• ìˆìŒ (ë‹¨, ë°ì´í„° ì²˜ë¦¬ ê´€ë ¨ë§Œ)


@@@@@@@ ë°ì´í„° ìˆ˜ì •í•˜ê¸°.@@@@@@@@@@@
public void insert(TodoVO todoVO) throws Exception{   // TodoVOì— ì •ì˜ëœ tno, title, dueDate, finishedë¼ëŠ” 4ê°œì˜ í•„ë“œëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ë‹´ê¸´ todoVO ê°ì²´ ì•ˆì— ë“¤ì–´ê°€ ìˆëŠ” ìƒíƒœ
        // ë“±ë¡ insert sql ë¬¸ì¥ ì‘ì„±.
        String sql = "insert into tbl_todo (title, dueDate, finished) values (?, ?, ?)";

//        ë””ë¹„ì— ì—°ê²°í•  ê°ì²´ ì‘ì„±... ìì›ë°˜ë‚©ë°©ë²•ì€ @Cleanup
        @Cleanup Connection connection = ConnectionUtil.INSTANCE.getConnection();
        @Cleanup PreparedStatement pstmt = connection.prepareStatement(sql);

        pstmt.setString(1, todoVO.getTitle());
        pstmt.setDate(2, Date.valueOf(todoVO.getDueDate()));
                    		// Date.valueOf : java.time.LocalDateë¥¼ java.sql.Dateë¡œ ë³€í™˜í•˜ëŠ” í•„ìˆ˜ ì‘ì—…
        pstmt.setBoolean(3, todoVO.isFinished());

        // ì‹¤ì œ ë””ë¹„ì„œë²„ì— ë°˜ì˜í•˜ê¸°. ì“°ê¸° ì‘ì—… ì§„í–‰.
        pstmt.executeUpdate();

    }